import{$ as st,A as M,C as y,D as X,E as c,F as S,G as k,H as Y,J as q,K as J,L as Q,V as Z,W as R,X as N,Y as tt,Z as et,_ as it,aa as ot,b as B,c as b,d as G,e as U,p as V,r as K,s as E,u as z,w as f,y as x,z as I}from"./chunk-MVXNA43C.js";import{c as L,e as O,l as _}from"./chunk-NZ2IDIBB.js";var h=L(O(),1);var n=L(O(),1);function D(){let[s,t]=n.default.useState(!1),e=()=>{t(!s)};return n.default.createElement(n.default.Fragment,null,n.default.createElement("button",{onClick:e,className:"textButton"},"About"),s&&n.default.createElement(ct,{openToggle:e}))}function ct({openToggle:s}){return n.default.createElement("div",{className:"dialog"},n.default.createElement("button",{onClick:s},"X"),n.default.createElement("h1",null,"About"),"Celestiary is a cosmological simulator.",n.default.createElement("h2",null,"News"),n.default.createElement("ul",null,n.default.createElement("li",null,"2021 Jan 25 - Works in Safari 13.1.2+ on OSX, maybe earlier. Now all major browsers tested except IE.")),n.default.createElement("h2",null,"Features"),n.default.createElement("ul",null,n.default.createElement("li",null,"Keplerian orbits (6 orbital elements)"),n.default.createElement("li",null,"Time controls, to alter rate and direction of time"),n.default.createElement("li",null,"Star colors based on surface temperatures"),n.default.createElement("li",null,"Star surface dynamics simulation (Perlin noise in black-body spectra)"),n.default.createElement("li",null,"9 planets, 20 moons"),n.default.createElement("li",null,"Permanent links for scene locations"),n.default.createElement("li",null,"Even kinda works on mobile! :)")),n.default.createElement("h2",null,"Datasets"),n.default.createElement("ul",null,n.default.createElement("li",null,"~100,000 stars"),n.default.createElement("li",null,"~3k star names"),n.default.createElement("li",null,"~80 Asterisms/constellations")),n.default.createElement("h2",null,"Learn more"),n.default.createElement("ul",null,n.default.createElement("li",null,n.default.createElement(_,{to:"/guide"},"Software development guide")),n.default.createElement("li",null,n.default.createElement("a",{href:"https://github.com/pablo-mayrgundter/celestiary",target:"_blank"},"Source code (GitHub)"))))}var T=class{constructor(t){this.time=t,this.Y_AXIS=new b(0,1,0)}animate(t){this.time.updateTime(),this.animateSystem(t,this.time.simTime/1e3)}animateSystem(t,e){if(t.preAnimCb&&t.preAnimCb(this.time),t.siderealRotationPeriod){let i=1.5*Math.PI+e/86400*M;t.setRotationFromAxisAngle(this.Y_AXIS,i)}if(t.orbit){let i=t.orbit.eccentricity,r=t.orbit.semiMajorAxis.scalar*y,o=r*Math.sqrt(1-Math.pow(i,2)),l=-1*e/t.orbit.siderealOrbitPeriod.scalar*M,a=r*Math.cos(l),d=0,g=o*Math.sin(l);t.position.set(a,d,g),t.postAnimCb&&t.postAnimCb(t)}for(let i in t.children){let r=t.children[i];this.animateSystem(r,e)}}};var v=class{constructor(t,e){this.containerElt=t,this.loader=e}getPathTarget(t){return t[t.length-1]}showNavDisplay(t){let e="";for(let o=0;o<t.length;o++){let l=t.slice(0,o+1).join("/"),a=t[o];o==t.length-1?e+=f(a):e+='<a href="#'+l+'">'+f(a)+"</a>",o<t.length-1&&(e+=" &gt; ")}let i=e+` <ul>
`,r=t.join("/");i+=this.showInfoRecursive(this.loader.loaded[this.getPathTarget(t)],r,!1,!1),i+=`</ul>
`,this.containerElt.innerHTML=i,Y(this.containerElt)}showInfoRecursive(t,e,i,r){let o="";for(let l in t)if(!(l=="name"||l=="parent"||l.startsWith("texture_"))&&t.hasOwnProperty(l)){let a=t[l];if(l=="system"&&typeof a=="object"&&Array.isArray(a)&&a.length==0)continue;if(o+="<li>",i||(o+=l+": "),a instanceof k){switch(l){case"radius":a=a.convertTo(k.Magnitude.KILO);break;case"mass":a=a.convertTo(k.Magnitude.KILO);break;case"semiMajorAxis":typeof a.scalar=="string"&&(a.scalar=parseFloat(a.scalar)),a.scalar=a.scalar.toExponential(4),a=a.toString();break;case"siderealOrbitPeriod":a=rt(a.scalar);break;case"siderealRotationPeriod":a=rt(a.scalar);break}o+=a}else if(a instanceof Array)l=="system"?o+=`<ol>
`:o+=`<ol class="collapsed">
`,o+=this.showInfoRecursive(a,e,!0,l=="system"),o+=`</ol>
`;else if(a instanceof Object)o+=`<ul class="collapsed">
`,o+=this.showInfoRecursive(a,e,!1,!1),o+=`</ul>
`;else{if(r){let d=e;e.length>0&&(d+="/"),d+=a,o+='<a href="#'+d+'">',o+=f(a)}else o+=a;r&&(o+="</a>")}o+=`</li>
`}return o}};function rt(s){let t=86400*365,e="",i=parseInt(s/t);i>0&&(s-=i*t,e+=`${i}y`);let r=parseInt(s/86400);r>0&&(s-=r*86400,e+=` ${r}d`);let o=parseInt(s/3600);o>0&&(s-=o*3600,e+=` ${o}h`);let l=parseInt(s/60);l>0&&(s-=l*60,e+=` ${l}m`);let a=parseInt(s);return a>0&&(e+=` ${a}s`),e}function at(s,t,e,i){this.ray=new G(s,t),this.near=e||0,this.far=i||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("CustomRaycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function nt(s,t){return s.distanceToRay-t.distanceToRay}function F(s,t,e,i){if(s.visible!==!1&&(s.raycast(t,e),i===!0))for(var r=s.children,o=0,l=r.length;o<l;o++)F(r[o],t,e,!0)}Object.assign(at.prototype,{linePrecision:1,set:function(s,t){this.ray.set(s,t)},setFromCamera:function(s,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(s.x,s.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(s.x,s.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("CustomRaycaster: Unsupported camera type.")},intersectObject:function(s,t,e){var i=e||[];return F(s,this,i,t),i.sort(nt),i},intersectObjects:function(s,t,e){var i=e||[];if(Array.isArray(s)===!1)return console.warn("CustomRaycaster.intersectObjects: objects is not an Array."),i;for(var r=0,o=s.length;r<o;r++)F(s[r],this,i,t);return i.sort(nt),i}});var ht=y;var mt=10,j=class{constructor(t){this.ui=t,this.objects={},this.mouse=new B,this.raycaster=new V,this.raycaster.params.Points.threshold=3,t.addClickCb(e=>{this.onClick(e)}),this.stars=null,this.sun=null,this.asterisms=null}add(t){let e=t.name,i=this.objects[t.parent],r=this.objects[t.parent+".orbitPosition"];if((t.name=="milkyway"||t.name=="sun")&&(i=r=this.ui.scene),!i||!r)throw new Error(`No parent obj: ${i} or pos: ${r} for ${e}`);r.add(this.objectFactory(t))}objectFactory(t){switch(t.type){case"galaxy":return this.newGalaxy(t);case"stars":return this.stars=new et(t,()=>{this.stars.showLabels()}),this.stars;case"star":return this.sun=new tt(t,this.objects,this.ui),this.sun;case"planet":return new N(this,t);case"moon":return new N(this,t,!0)}throw new Error(`Object has unknown type: ${t.type}`)}newObject(t,e,i){let r=this.newGroup(t,e);if(!i)throw new Error("Must provide an onClick handler");return r.onClick=i,r}newGroup(t,e){let i=new U;return this.objects[t]=i,i.name=t,e&&(i.props=e),i}targetNamed(t){this.setTarget(t),this.lookAtTarget()}targetParent(){let t=c.cur;t&&t.props&&t.props.parent&&this.setTarget(t.props.parent)}targetNode(t){let e=c.cur;if(e&&e.props&&e.props.system&&e.props.system){let i=e.props.system;i[t-1]&&this.setTarget(i[t-1])}}targetCurNode(){let t=c.cur;t&&t.props&&t.props.name&&this.setTarget(t.props.name)}setTarget(t){let e=this.objects[t];if(!e)throw new Error(`scene#setTarget: no matching target: ${t}`);c.obj=e}lookAtTarget(){if(!c.obj){console.error("scene.js#lookAtTarget: no target obj to look at.");return}let t=c.obj,e=c.pos;this.ui.scene.updateMatrixWorld(),e.setFromMatrixPosition(t.matrixWorld),this.ui.camera.lookAt(e)}goTo(){if(!c.obj){console.error("Scene.goTo called with no target obj.");return}let t=c.obj,e=c.pos;this.ui.scene.updateMatrixWorld(),e.setFromMatrixPosition(t.matrixWorld);let i=new b,r=new b,o=t.props.radius.scalar*ht,l=mt;i.set(0,0,0),r.set(0,0,o*l),t.orbitPosition.add(this.ui.camera.platform),this.ui.camera.platform.position.copy(i),this.ui.camera.platform.lookAt(c.origin),this.ui.camera.position.copy(r),this.ui.camera.lookAt(e),c.track=c.cur=c.obj,this.ui.controls.update()}track(t){c.track?c.track=null:c.track=c.obj}follow(t){if(c.follow)delete c.follow.postAnimCb,c.follow=null;else if(c.obj)if(c.obj.orbitPosition){let e=c.obj.orbitPosition;c.follow=e,e.postAnimCb=i=>{this.ui.camera.platform.lookAt(c.origin)},e.postAnimCb(e)}else console.error("Target to follow has no orbitPosition property.");else console.error("No target object to follow.")}onClick(t){return;for(let P=0;P<i.length;P++){let p=i[P],C=p.distance,w=p.object;if(w.isAnchor){console.log("raycast skipping anchor");continue}if(w.type!="Line")switch(w.type){case"Mesh":{if(o&&o.distance<C)continue;o=p}break;case"Points":if(w.isStarPoints){if(a&&a.distanceToRay<p.distanceToRay)continue;a=p}else{if(l&&l.distance<C)continue;l=p}break;case"Group":break;default:{if(d&&d.distance<C)continue;d=p}}}}toggleAsterisms(){if(this.asterisms==null){let t=new R(this.stars,()=>{this.stars.add(t),console.log("Asterisms count:",t.catalog.numAsterisms),this.asterisms=t})}this.asterisms&&(this.asterisms.visible=!this.asterisms.visible)}toggleOrbits(){x(this.sun,"name","orbit","visible")}togglePlanetLabels(){x(this.sun,"name","label","visible")}toggleStarLabels(){this.stars.labelLOD.visible=!this.stars.labelLOD.visible}newGalaxy(t){let e=this.newObject(t.name,t,i=>{});return this.objects[t.name+".orbitPosition"]=e,e}};var lt="sun",$=s=>document.getElementById(s),A=class{constructor(t,e,i){z(arguments,3),this.time=new st(i),this.animation=new T(this.time),t.style.width=window.innerWidth+"px",t.style.height=window.innerHeight+"px";let r=o=>{this.animation.animate(o),c.track&&this.scene.lookAtTarget()};this.ui=new it(t,r),this.scene=new j(this.ui),this.loader=new J,this.controlPanel=new v(e,this.loader),this.load(),this.setupListeners(),this.navVisible=!0,this.shared=S,this.shapes=Z,this.three=K,this.utils=I,this.toggleHelp=null}getTime(){if(this.time===null)throw new Error("Null time");return this.time}setTitle(t){let e="Celestiary";t.length>=1&&(e=f(t[t.length-1])),document.title=e}load(){this.onLoadCb=(e,i)=>{Q(i),this.scene.add(i)},this.onDoneCb=(e,i)=>{this.controlPanel.showNavDisplay(e.split("/"),this.loader),setTimeout(()=>{let r=e.split("/"),o=r[r.length-1];o.indexOf("-")>=0&&(o=o.split("-")[0]),this.scene.targetNamed(o),this.scene.goTo(),this.setTitle(r)},0)};let t;location.hash?t=location.hash.substring(1):(t=lt,location.hash=t),this.loader.loadPath("milkyway",this.onLoadCb,()=>{this.loader.loadPath(t,this.onLoadCb,this.onDoneCb,()=>{setTimeout(()=>{location.hash=lt},1e3)})})}goTo(){let t=this.shared.targets.obj;if(t)if(t.props&&t.props.name){let e=this.loader.pathByName[t.props.name];e?window.location.hash=e:console.error(`no loaded path for ${t.props.name}: ${e}`)}else console.error("target obj has no name prop: ",t);else console.error("no target obj!")}setupListeners(){window.addEventListener("hashchange",e=>{this.loader.loadPath((window.location.hash||"#").substring(1),this.onLoadCb,this.onDoneCb)},!1);let t=new q;t.map("Escape",()=>{this.hideActiveDialog()},"Hide active dialog"),t.map(" ",()=>{this.time.togglePause()},"Toggle time pause"),t.map(",",()=>{this.ui.multFov(.9)},"Narrow field-of-vision"),t.map(".",()=>{this.ui.multFov(1.1)},"Broaden field-of-vision"),t.map("/",()=>{this.ui.resetFov()},"Reset field-of-vision to "+X+"\xBA"),t.map("0",()=>{this.scene.targetCurNode()},"Target current system");for(let e=1;e<=9;e++)t.map(""+e,()=>{let i=e;this.scene.targetNode(i)},`Look at child ${e} of current system`);t.map(";",()=>{this.time.changeTimeScale(0)},"Change time scale to real-time"),t.map("c",()=>{this.scene.lookAtTarget()},"Look at target"),t.map("f",()=>{this.scene.follow()},"Follow current node"),t.map("g",()=>{this.goTo()},"Go to target node"),t.map("j",()=>{this.time.invertTimeScale()},"Reverse time"),t.map("k",()=>{this.time.changeTimeScale(-1)},"Slow down time"),t.map("l",()=>{this.time.changeTimeScale(1)},"Speed up time"),t.map("n",()=>{this.time.setTimeToNow()},"Set time to now"),t.map("t",()=>{this.scene.track()},"Track target node"),t.map("u",()=>{this.scene.targetParent()},"Look at parent of current system"),t.map("A",()=>{this.scene.toggleAsterisms()},"Show/hide asterisms"),t.map("O",()=>{this.scene.toggleOrbits()},"Show/hide orbits"),t.map("P",()=>{this.scene.togglePlanetLabels()},"Show/hide planet and moon names"),t.map("S",()=>{this.scene.toggleStarLabels()},"Show/hide star names"),t.map("V",()=>{[$("nav-id"),$("top-right")].map(i=>{i.style.visibility=this.navVisible?"hidden":"visible"}),this.navVisible=!this.navVisible},"Show/hide navigation panels"),this.keys=t}hideActiveDialog(){document.querySelectorAll(".dialog").forEach(t=>this.hideElt(t))}hideElt(t){t.style.display="none"}toggleEltDisplay(t){return t.style.display=="block"?(this.hideElt(t),!1):(this.hideActiveDialog(),t.style.display="block",!0)}hideHelpOnEscape(){let t=$("keys-id");t.style.display="none"}};var u=L(O(),1);function dt(s){let t="";return s.timeScale==1?t="real-time":t=s.timeScale.toLocaleString()+" secs/s",s.pause&&(t+=" (paused)"),t}function H({time:s,timeStr:t}){let[e,i]=u.default.useState("");return u.default.useEffect(()=>{i(dt(s))},[t]),u.default.createElement("div",{id:"time-id"},u.default.createElement("div",{id:"date-id"},t),u.default.createElement("div",{id:"time-scale-id"},e),u.default.createElement("div",{id:"time-controls-id"},u.default.createElement("button",{onClick:()=>{s.changeTimeScale(1)}},"+"),u.default.createElement("button",{onClick:()=>{s.changeTimeScale(-1)}},"-"),u.default.createElement("button",{onClick:()=>{s.changeTimeScale(0)}},"="),u.default.createElement("button",{onClick:()=>{s.invertTimeScale()}},"/")))}function ut(){let[s,t]=h.default.useState(null),[e,i]=h.default.useState("bar"),[r,o]=h.default.useState(!1);return h.default.useEffect(()=>{t(new A(E("scene-id"),E("nav-id"),i))},[]),h.default.createElement(h.default.Fragment,null,h.default.createElement("div",{id:"scene-id"}),h.default.createElement("div",{id:"nav-id",className:"panel"},"Welcome to Celestiary!  Loading..."),h.default.createElement("div",{id:"top-right",className:"panel"},s&&h.default.createElement(H,{time:s.time,timeStr:e}),s&&h.default.createElement(ot,{keys:s.keys}),h.default.createElement(D,null)),h.default.createElement("h1",{id:"target-id"}))}export{ut as default};
//# sourceMappingURL=App-NEJ65QRQ.js.map
